<!-- I2C interface in a browser -->

<!DOCTYPE html>
<html>

<head>
<title>Web-I2C: an I2C interface in a browser</title>
<link rel="stylesheet" href="styles.css" />
</head>

<body onload="main();">
<h1><center>Web-I2C: an I2C interface in a browser</center></h1>

<textarea id='interface' rows="20" cols="50" readOnly></textarea>
<br/>
<button id='connect' onclick='connect();'>CONNECT</button>
<button id='disconnect' onclick='disconnect();'>DISCONNECT</button>
</br>

<script src="./i2c.js"></script>

<script>
"use strict";

const connect_button = document.getElementById('connect');
const disconnect_button = document.getElementById('disconnect');
const text = document.getElementById('interface');

var I2C = undefined;

function main() {
  I2C = undefined;
  text.innerHTML = "READY";
}

////////////////////////////////////////////////////////////////////////////////

async function connect() {
  if (I2C == undefined) {
    I2C = new I2C_Device();
    I2C.connect().then(async () => {
      if (I2C.device == undefined) {
        I2C = null;
        return;  // error
      }
      connect_button.style.display = 'none';
      disconnect_button.style.display = 'initial';
      text.innerHTML = "Started.\n";
      const hdr = I2C.get_flash_status();
      hdr.forEach(s => text.innerHTML += " == " + s + "\n");
      const str = await I2C.get_status();
      str.forEach(s => text.innerHTML += " = " + s + "\n");
    });
  }
}

async function disconnect() {
  if (I2C == undefined) return;
  connect_button.style.display = 'initial';
  disconnect_button.style.display = 'none';
  await I2C.disconnect();
  I2C = undefined;
  text.innerHTML = "Disconnected.";
}

////////////////////////////////////////////////////////////////////////////////
</script>

</body>
</html>
